<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.guroomsoft.icms.biz.code.dao.PlantDAO">

    <!-- 플랜트 목록 조회 -->
    <select id="selectPlant" resultType="plant" parameterType="plant">
        select /* PlantMapper.selectPlant */
            a.*, b.corp_nm
            , dbo.FN_GET_CODE_NAME('C08', a.plant_country) AS plantCountryNm
            , dbo.FN_GET_CODE_NAME('C03', a.use_at) AS useAtNm
        from MT_PLANT a WITH (NOLOCK)
             left outer join MT_CORPORATION b ON a.corp_cd = b.corp_cd
        <where>
            <if test='corpCd != null and !corpCd.equals("")'> AND a.corp_cd = #{corpCd}</if>
            <if test='plantCd != null and !plantCd.equals("")'> AND a.plant_cd = #{plantCd}</if>
            <if test='plantNm != null and !plantNm.equals("")'> AND CONCAT(a.plant_cd, a.plant_nm)  LIKE CONCAT('%', #{plantNm}, '%')</if>
            <if test='plantCountry != null and !plantCountry.equals("")'> AND a.plant_country = #{plantCountry}</if>
            <if test='useAt != null and !useAt.equals("")'> AND a.use_at = #{useAt}</if>
        </where>
        order by a.corp_cd, a.plant_cd
    </select>

    <!-- 플랜트 상세 조회 -->
    <select id="selectPlantByKey" resultType="plant" parameterType="String">
        select /* PlantMapper.selectPlantByKey */
            a.*, b.corp_nm
             , dbo.FN_GET_CODE_NAME('C08', a.plant_country) AS plantCountryNm
             , dbo.FN_GET_CODE_NAME('C03', a.use_at) AS useAtNm
        from MT_PLANT a WITH (NOLOCK)
             left outer join MT_CORPORATION b ON a.corp_cd = b.corp_cd
        where a.plant_cd = #{plantCd}
    </select>
    
    <!-- 플랜트 등록 -->
    <insert id="insertPlant" parameterType="plant">
        insert /* PlantMapper.insertPlant */ 
        into MT_PLANT(plant_cd, plant_nm, corp_cd, plant_country, use_at, reg_uid, reg_dt)
        values (
                #{plantCd}, #{plantNm}, #{corpCd}, #{plantCountry}, #{useAt}, #{regUid}, GETDATE()
        )
    </insert>
    
    <!-- 플랜트 수정 -->
    <update id="updatePlant" parameterType="plant">
        update /* PlantMapper.updatePlant */
            MT_PLANT
        <set>
            <if test='corpCd != null and !corpCd.equals("")'> corp_cd = #{corpCd}, </if>
            <if test='plantNm != null and !plantNm.equals("")'> plant_nm = #{plantNm}, </if>
            <if test='plantCountry != null'> plant_country = #{plantCountry},</if>
            <if test='useAt != null'> use_at = #{useAt},</if>
            mod_uid = #{modUid},
            mod_dt = GETDATE()
        </set>
        where plant_cd = #{plantCd}
    </update>

    <!-- 플랜트 삭제 -->
    <delete id="deletePlant" parameterType="String">
        delete /* PlantMapper.deletePlant */
        from MT_PLANT
        <where>
            <if test='corpCd != null and !corpCd.equals("")'>AND corp_cd = #{corpCd}</if>
            <if test='plantCd != null and !plantCd.equals("")'>AND plant_cd = #{plantCd}</if>
        </where>

    </delete>
</mapper>